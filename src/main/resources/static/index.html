<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invitaci√≥n de Boda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Cormorant+Garamond:wght@400;500&display=swap');
        
        body {
            font-family: 'Cormorant Garamond', serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .title {
            font-family: 'Playfair Display', serif;
        }
        
        .card-wedding {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .gold-text {
            color: #d4af37;
        }
        
        .button-wedding {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .button-wedding:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .button-confirm {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .button-confirm:hover {
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
        }
        
        .countdown-item {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(212, 175, 55, 0.05) 100%);
            border: 1px solid #d4af37;
        }
        
        .input-wedding {
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .input-wedding:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }
        
        .error-message {
            color: #dc2626;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .success-message {
            color: #059669;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .decoration {
            opacity: 0.1;
            position: absolute;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
    </style>
</head>
<body class="tracking-wider">
    <div class="relative min-h-screen overflow-hidden">
        <!-- Decoraciones -->
        <div class="decoration top-10 left-10 text-6xl float-animation">üíí</div>
        <div class="decoration top-1/3 right-10 text-5xl float-animation" style="animation-delay: 1s;">üíê</div>
        <div class="decoration bottom-20 left-1/4 text-6xl float-animation" style="animation-delay: 2s;">üåπ</div>
        
        <!-- Contenido Principal -->
        <div class="min-h-screen flex items-center justify-center p-4">
            <div id="loading" class="text-center">
                <div class="inline-block">
                    <div class="animate-spin rounded-full h-12 w-12 border-4 border-white border-t-gold-500"></div>
                </div>
                <p class="text-white mt-4 text-lg">Cargando invitaci√≥n...</p>
            </div>
            
            <!-- Card Principal (Oculto inicialmente) -->
            <div id="main-content" class="hidden w-full max-w-2xl">
                <!-- Header -->
                <div class="text-center mb-8 text-white">
                    <h1 class="title text-5xl md:text-6xl mb-2 gold-text">Nuestra Boda</h1>
                    <p class="text-xl opacity-90">17 de Diciembre de 2025</p>
                </div>
                
                <!-- Card Principal -->
                <div class="card-wedding rounded-3xl shadow-2xl p-8 md:p-12 mb-6">
                    <!-- Mensaje de Bienvenida -->
                    <div class="text-center mb-8">
                        <h2 id="welcome-message" class="title text-3xl md:text-4xl mb-2 gold-text"></h2>
                        <p id="invite-text" class="text-gray-600 text-lg"></p>
                    </div>
                    
                    <!-- Decoraci√≥n -->
                    <div class="flex justify-center gap-3 mb-8 text-gold-500">
                        <span class="text-3xl">‚úø</span>
                        <span class="text-3xl">‚úø</span>
                        <span class="text-3xl">‚úø</span>
                    </div>
                    
                    <!-- Informaci√≥n del evento -->
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 mb-8">
                        <h3 class="title text-2xl text-purple-900 mb-4">Detalles del Evento</h3>
                        
                        <div class="space-y-4">
                            <div class="flex items-start gap-4">
                                <span class="text-2xl">üìç</span>
                                <div>
                                    <p class="font-semibold text-gray-800">Lugar</p>
                                    <p class="text-gray-600">Sal√≥n de Eventos "La Hacienda"<br>Calle Principal 123, Ciudad</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start gap-4">
                                <span class="text-2xl">üïê</span>
                                <div>
                                    <p class="font-semibold text-gray-800">Hora</p>
                                    <p class="text-gray-600">6:00 PM - Ceremonia<br>7:00 PM - Recepci√≥n</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start gap-4">
                                <span class="text-2xl">üìû</span>
                                <div>
                                    <p class="font-semibold text-gray-800">Contacto</p>
                                    <p class="text-gray-600">+34 XXX XX XX XX</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cuenta Regresiva -->
                    <div class="mb-8">
                        <h3 class="title text-2xl text-purple-900 mb-4 text-center">¬°Faltan...</h3>
                        <div class="grid grid-cols-4 gap-3">
                            <div class="countdown-item rounded-lg p-4 text-center">
                                <div class="text-3xl font-bold gold-text" id="days">0</div>
                                <div class="text-sm text-gray-600 mt-2">D√≠as</div>
                            </div>
                            <div class="countdown-item rounded-lg p-4 text-center">
                                <div class="text-3xl font-bold gold-text" id="hours">0</div>
                                <div class="text-sm text-gray-600 mt-2">Horas</div>
                            </div>
                            <div class="countdown-item rounded-lg p-4 text-center">
                                <div class="text-3xl font-bold gold-text" id="minutes">0</div>
                                <div class="text-sm text-gray-600 mt-2">Minutos</div>
                            </div>
                            <div class="countdown-item rounded-lg p-4 text-center">
                                <div class="text-3xl font-bold gold-text" id="seconds">0</div>
                                <div class="text-sm text-gray-600 mt-2">Segundos</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bot√≥n Google Maps -->
                    <div class="mb-8 flex justify-center">
                        <a href="https://maps.google.com/maps?q=Calle+Principal+123,+Ciudad" 
                           target="_blank" 
                           rel="noopener noreferrer"
                           class="button-wedding text-white px-8 py-3 rounded-lg font-semibold flex items-center gap-2 hover:scale-105 transition-transform">
                            <span>üìç</span>
                            <span>Ver en Google Maps</span>
                        </a>
                    </div>
                    
                    <!-- Decoraci√≥n -->
                    <div class="flex justify-center gap-3 mb-8 text-gold-500">
                        <span class="text-3xl">‚úø</span>
                        <span class="text-3xl">‚úø</span>
                        <span class="text-3xl">‚úø</span>
                    </div>
                    
                    <!-- Formulario de Confirmaci√≥n -->
                    <div class="bg-gradient-to-r from-pink-50 to-purple-50 rounded-2xl p-6">
                        <h3 class="title text-2xl text-purple-900 mb-4">Confirma tu Asistencia</h3>
                        
                        <form id="confirmation-form" class="space-y-4">
                            <!-- Personas Confirmadas -->
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">
                                    N√∫mero de Personas
                                    <span class="text-red-500">*</span>
                                </label>
                                <div class="flex items-center gap-2">
                                    <button type="button" 
                                            id="decrease-btn" 
                                            class="button-wedding text-white px-4 py-2 rounded-lg font-bold">
                                        ‚àí
                                    </button>
                                    <input type="number" 
                                           id="pases-input" 
                                           name="pases" 
                                           min="0" 
                                           max="" 
                                           value="0" 
                                           class="input-wedding flex-1 px-4 py-2 rounded-lg text-center text-lg font-semibold"
                                           readonly>
                                    <button type="button" 
                                            id="increase-btn" 
                                            class="button-wedding text-white px-4 py-2 rounded-lg font-bold">
                                        +
                                    </button>
                                </div>
                                <div id="pases-error" class="error-message hidden"></div>
                            </div>
                            
                            <!-- Mensaje Especial -->
                            <div>
                                <label for="mensaje" class="block text-gray-700 font-semibold mb-2">
                                    Mensaje Especial (Opcional)
                                </label>
                                <textarea id="mensaje" 
                                          name="mensaje" 
                                          rows="3" 
                                          placeholder="Comparte un mensaje especial con los novios..."
                                          class="input-wedding w-full px-4 py-2 rounded-lg focus:ring-2 focus:ring-purple-500 resize-none"></textarea>
                            </div>
                            
                            <!-- Bot√≥n Enviar -->
                            <button type="submit" 
                                    id="submit-btn"
                                    class="button-confirm w-full text-white px-6 py-3 rounded-lg font-semibold text-lg mt-6">
                                Confirmar Asistencia
                            </button>
                            
                            <!-- Mensajes de Estado -->
                            <div id="success-message" class="success-message hidden text-center">
                                ‚úì ¬°Asistencia confirmada! Gracias por tu respuesta.
                            </div>
                            <div id="error-message" class="error-message hidden text-center"></div>
                        </form>
                    </div>
                </div>
                
                <!-- Footer -->
                <div class="text-center text-white opacity-75">
                    <p class="text-sm">Agradecemos tu asistencia a nuestro gran d√≠a</p>
                    <p class="title text-2xl mt-2 gold-text">‚ù§Ô∏è</p>
                </div>
            </div>
            
            <!-- Mensaje de Error (Invitado no encontrado) -->
            <div id="error-content" class="hidden text-center text-white">
                <h2 class="title text-4xl mb-4">Invitaci√≥n no encontrada</h2>
                <p class="text-xl mb-6 opacity-90">Parece que el c√≥digo de invitaci√≥n no es v√°lido.</p>
                <p class="opacity-75">Si crees que esto es un error, por favor contacta a los novios.</p>
            </div>
        </div>
    </div>
    
    <script>
        // Configuraci√≥n
        const API_BASE_URL = '/api/invitados';
        const WEDDING_DATE = new Date('2025-12-17T18:00:00').getTime();
        
        // Variables globales
        let currentInvitado = null;
        
        // Funciones principales
        async function loadInvitado() {
            const urlParams = new URLSearchParams(window.location.search);
            const slug = urlParams.get('id');
            
            if (!slug) {
                showError();
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/${slug}`);
                
                if (!response.ok) {
                    showError();
                    return;
                }
                
                currentInvitado = await response.json();
                displayInvitado();
                startCountdown();
            } catch (error) {
                console.error('Error cargando invitaci√≥n:', error);
                showError();
            }
        }
        
        function displayInvitado() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            
            // Mensajes de bienvenida
            document.getElementById('welcome-message').textContent = 
                `¬°Hola ${currentInvitado.nombreFamilia}!`;
            document.getElementById('invite-text').textContent = 
                `Tienes ${currentInvitado.pasesTotales} pase${currentInvitado.pasesTotales > 1 ? 's' : ''} disponible${currentInvitado.pasesTotales > 1 ? 's' : ''}`;
            
            // Configurar l√≠mite m√°ximo de pases
            document.getElementById('pases-input').max = currentInvitado.pasesTotales;
            
            // Cargar datos previos si existen
            if (currentInvitado.confirmado) {
                document.getElementById('pases-input').value = currentInvitado.pasesConfirmados;
                document.getElementById('mensaje').value = currentInvitado.mensaje || '';
                document.getElementById('success-message').classList.remove('hidden');
            }
        }
        
        function showError() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error-content').classList.remove('hidden');
        }
        
        function startCountdown() {
            function updateCountdown() {
                const now = new Date().getTime();
                const distance = WEDDING_DATE - now;
                
                if (distance < 0) {
                    document.getElementById('days').textContent = '0';
                    document.getElementById('hours').textContent = '0';
                    document.getElementById('minutes').textContent = '0';
                    document.getElementById('seconds').textContent = '0';
                    return;
                }
                
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                
                document.getElementById('days').textContent = String(days).padStart(2, '0');
                document.getElementById('hours').textContent = String(hours).padStart(2, '0');
                document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
                document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
            }
            
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }
        
        // Manejadores de eventos para los botones
        document.getElementById('increase-btn').addEventListener('click', () => {
            const input = document.getElementById('pases-input');
            const max = parseInt(input.max);
            const current = parseInt(input.value);
            
            if (current < max) {
                input.value = current + 1;
                clearMessages();
            }
        });
        
        document.getElementById('decrease-btn').addEventListener('click', () => {
            const input = document.getElementById('pases-input');
            const current = parseInt(input.value);
            
            if (current > 0) {
                input.value = current - 1;
                clearMessages();
            }
        });
        
        // Permitir entrada directa
        document.getElementById('pases-input').addEventListener('change', () => {
            const input = document.getElementById('pases-input');
            const max = parseInt(input.max);
            let value = parseInt(input.value) || 0;
            
            if (value > max) {
                value = max;
            } else if (value < 0) {
                value = 0;
            }
            
            input.value = value;
            clearMessages();
        });
        
        // Manejador del formulario de confirmaci√≥n
        document.getElementById('confirmation-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const pases = parseInt(document.getElementById('pases-input').value);
            const mensaje = document.getElementById('mensaje').value;
            
            if (pases > currentInvitado.pasesTotales) {
                document.getElementById('pases-error').textContent = 
                    `No puedes confirmar m√°s de ${currentInvitado.pasesTotales} personas`;
                document.getElementById('pases-error').classList.remove('hidden');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/confirmar`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        slug: currentInvitado.slug,
                        pasesConfirmados: pases,
                        mensaje: mensaje
                    })
                });
                
                if (response.ok) {
                    currentInvitado = await response.json();
                    document.getElementById('success-message').classList.remove('hidden');
                    document.getElementById('error-message').classList.add('hidden');
                    document.getElementById('pases-error').classList.add('hidden');
                    
                    // Desplazar al top
                    setTimeout(() => {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }, 300);
                } else {
                    document.getElementById('error-message').textContent = 
                        'Error al confirmar. Intenta nuevamente.';
                    document.getElementById('error-message').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error confirmando:', error);
                document.getElementById('error-message').textContent = 
                    'Error de conexi√≥n. Intenta nuevamente.';
                document.getElementById('error-message').classList.remove('hidden');
            }
        });
        
        function clearMessages() {
            document.getElementById('success-message').classList.add('hidden');
            document.getElementById('error-message').classList.add('hidden');
            document.getElementById('pases-error').classList.add('hidden');
        }
        
        // Cargar la invitaci√≥n cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', loadInvitado);
    </script>
</body>
</html>
